package main

import (
	"github.com/gin-gonic/gin"
    "github.com/joho/godotenv"
    "fmt"
    "database/sql"
    _ "github.com/lib/pq"
    "os"
	{libraries}
)

var dbMap = initDb()

func main() {
    godotenv.Load()
	r := gin.Default()
    //->generate
{generate}
    //->endGenerate
    defer dbMap.Close()
	r.Run()
}


func initDb() *sql.DB {
	psqlInfo := fmt.Sprintf("host=%s port=%d user=%s "+
		"password=%s dbname=%s sslmode=disable",
        goDotEnvVariable("DB_HOST"),
        goDotEnvVariable("DB_PORT"),
        goDotEnvVariable("DB_USER"),
        goDotEnvVariable("DB_PASSWORD"),
        goDotEnvVariable("DB_NAME"),
    )
	db, err := sql.Open(goDotEnvVariable("DB_DRIVER"), psqlInfo)
	if err != nil {
		panic(err)
	}
	return db
}

// use godot package to load/read the .env file and
// return the value of the key
func goDotEnvVariable(key string) string {
  return os.Getenv(key)
}
